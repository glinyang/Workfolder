{% extends "reports/base.html" %}

{% block title %}My Reports{% endblock %}

{% block css_myreports %}class="active"{% endblock %}

{% load reports_extras %}

{% block content %}
<div class="col-xs-10">
  <!-- Tab panes -->
  <div class="tab-content">
{% for week, week_data in data.items %}
    {% if forloop.counter == 1 %}
    <div class="tab-pane active" id="{{ week.isoformat }}">
    {% else %}
    <div class="tab-pane" id="{{ week.isoformat }}">
    {% endif %}
    {% include "reports/includes/week_title.html" %}
    {% if week_data|length == 0 %}
        <table class="table table-bordered">
            <tr>
                <td>
                 <div class="row">
                        <div class="col-md-1">
                            <a class="btn btn-default"
                                href="{% url 'reports:myreports_edit' week.year week.week %}">
                                <span class="glyphicon glyphicon-plus"></span> Create
                            </a>
                        </div>
                        <div class="col-md-10" style="text-align: center">
                            <strong>No reports</strong>
                        </div>
                        <div class="col-md-1" style="text-align: center">

                        </div>
                    </div>
                </td>
            </tr>
        </table>
        <br/>
    {% endif %}

    {% for user, user_data in week_data.items %}
    <table class="table table-bordered table-striped ">
        <tfoot>
            <tr>
                <td colspan="2">
                    <div class="row">
                        <div class="col-md-10">
                            <a class="btn btn-default" href="{% url 'reports:myreports_edit' week.year week.week %}">
                                <span class="glyphicon glyphicon-pencil"></span> Edit
                            </a>
                        </div>
                        <div class="col-md-*"
                            style="padding-right: 12px; text-align: right">Total
                            Efforts:</div>
                    </div>
                </td>
                <td>
                {% if user.2 ==  40 %}
                    <span class="label label-success">{{ user.2 }} hours</span>
                {% elif user.2 > 40 %}
                    <span class="label label-danger">{{ user.2 }} hours</span>
                {% else %}
                    <span class="label label-warning">{{ user.2 }} hours</span>
                {% endif %}
                </td>
            </tr>
        </tfoot>
        <tbody>
            <tr style="display:none;">
                <th class="col-md-2">Project</th>
                <th class="col-md-*">Work Items</th>
                <th class="col-md-1">Efforts</th>
            </tr>
            {% for project, project_data in user_data.items %}
            {% for workitem in project_data %}
            <tr>
                {% if forloop.counter == 1 %}
                <td  class="col-md-2" rowspan="{{ project.1 }}">{{ project.0 }}</td>
                {% endif %}
                <td  class="col-md-*">
                    {% if workitem.0 == 10 %}
                        <span class="label label-primary">{{ workitem.1 }}</span>
                    {% elif workitem.0 == 20 %}
                        <span class="label label-success">{{ workitem.1 }}</span>
                    {% elif workitem.0 == 50 %}
                        <span class="label label-warning">{{ workitem.1 }}</span>
                    {% else %}
                        <span class="label label-info">{{ workitem.1 }}</span>
                    {% endif %}
                    {% autoescape off %}
                    {{ workitem.2 }}
                    {% endautoescape %}
                    {% if workitem.3|length > 0 %}

                    <blockquote>
                        <p style="width: 700px; word-wrap: break-word; font-size: 100%; ">
                            <small>
                            {% autoescape off %}
                            {{ workitem.3|linebreaksbr }}
                            {% endautoescape %}
                            </small>
                        </p>
                    </blockquote>
                    {% endif %}
                </td>
                <td  class="col-md-1">{{ workitem.4 }} hrs</td>
            </tr>
            {% endfor %}    <!-- End WorkItem -->
            {% endfor %}    <!-- End Project -->

            <tr>
                <td colspan="3">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="bs-callout bs-callout-success">
                                <h4>Plan in This Week</h4>
                                <p>{{ user.3|linebreaksbr }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="bs-callout bs-callout-warning">
                                <h4>Plan for Next Week</h4>
                                <p>{{ user.4|linebreaksbr }}</p>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <br/>
    {% endfor %}    <!-- End User -->
    </div>
{% endfor %}
  </div>
</div>

<div class="col-xs-2"> <!-- required for floating -->
  <!-- Nav tabs -->
  <ul class="nav nav-tabs tabs-right">
{% for week, week_data in data.items %}
    {% if forloop.counter == 1 %}
        <li class="active"><a href="#{{ week.isoformat }}" data-toggle="tab">Week {{ week.week }} <small>(Current)</small></a></li>
    {% else %}
        {% if week.week == 52 %}
            <li>&nbsp;&nbsp;&nbsp;&nbsp;<small>--------- {{ week.friday|date:"Y" }} ---------</small><a href="#{{ week.isoformat }}" data-toggle="tab">Week {{ week.week }} <small>({{ week.friday|date:"M d" }})</small></a></li>
        {% elif week.week == 53 %}
            <li>&nbsp;&nbsp;&nbsp;&nbsp;<small>--------- {{ week.friday|date:"Y" }} ---------</small><a href="#{{ week.isoformat }}" data-toggle="tab">Week {{ week.week }} <small>({{ week.friday|date:"M d" }})</small></a></li>
        {% else %}
            <li><a href="#{{ week.isoformat }}" data-toggle="tab">Week {{ week.week }} <small>({{ week.friday|date:"M d" }})</small></a></li>
        {% endif %}
    {% endif %}
{% endfor %}

{% if show_all_data %}
{% else %}
<li><a href="{% url 'reports:myreports_all' %}">All My Reports...</a></li>
{% endif %}
  </ul>
</div>
{% endblock %}